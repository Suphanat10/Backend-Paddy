generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Account {
  user_ID              Int                    @id @default(autoincrement())
  first_name           String?                @db.VarChar(50)
  last_name            String?                @db.VarChar(50)
  birth_date           DateTime?              @db.Date
  gender               String?                @db.VarChar(50)
  phone_number         String?                @db.VarChar(10)
  user_id_line         String?                @db.VarChar(50)
  email                String?                @db.VarChar(50)
  password             String?                @db.VarChar(255)
  position             String?                @db.VarChar(50)
  Farm                 Farm[]
  Logs                 Logs[]
  OTP                  OTP[]
  device_registrations device_registrations[]
}

model Area {
  area_id              Int                    @id @default(autoincrement())
  farm_id              Int
  area_name            String?                @db.VarChar(100)
  created_at           DateTime?              @db.DateTime(0)
  Farm                 Farm                   @relation(fields: [farm_id], references: [farm_id], onDelete: Cascade, map: "Area_ibfk_1")
  device_registrations device_registrations[]

  @@index([farm_id], map: "farm_id")
}

model Device {
  device_ID            Int                    @id @default(autoincrement())
  device_code          String?                @db.VarChar(100)
  created_at           DateTime?              @db.DateTime(0)
  status               String?                @db.VarChar(20)
  device_registrations device_registrations[]
}

model Farm {
  farm_id          Int     @id @default(autoincrement())
  user_ID          Int
  area             Float?  @db.Float
  farm_name        String? @db.VarChar(50)
  gender           String? @db.VarChar(50)
  rice_variety     String? @db.VarChar(10)
  planting_method  String? @db.VarChar(50)
  soil_type        String? @db.VarChar(50)
  water_management String? @db.VarChar(100)
  address          String? @db.Text
  Area             Area[]
  Account          Account @relation(fields: [user_ID], references: [user_ID], onDelete: Cascade, map: "Farm_ibfk_1")

  @@index([user_ID], map: "user_ID")
}

model Growth_Analysis {
  analysis_id             Int                  @id @default(autoincrement())
  growth_stage            String               @db.VarChar(100)
  image_url               String               @db.VarChar(255)
  created_at              DateTime?            @default(now()) @db.DateTime(0)
  device_registrations_ID Int
  device_registrations    device_registrations @relation(fields: [device_registrations_ID], references: [device_registrations_ID], onDelete: Cascade, map: "Growth_Analysis_ibfk_1")

  @@index([device_registrations_ID], map: "device_registrations_ID")
}

model Logs {
  logs_ID    Int       @id @default(autoincrement())
  user_ID    Int
  ip_address String?   @db.VarChar(50)
  action     String    @db.VarChar(225)
  created_at DateTime? @default(now()) @db.DateTime(0)
  Account    Account   @relation(fields: [user_ID], references: [user_ID], onDelete: Cascade, map: "Logs_ibfk_1")

  @@index([user_ID], map: "user_ID")
}

model Logs_Alert {
  logs_alert_ID           Int                  @id @default(autoincrement())
  device_registrations_ID Int
  alert_message           String               @db.Text
  created_at              DateTime?            @default(now()) @db.DateTime(0)
  device_registrations    device_registrations @relation(fields: [device_registrations_ID], references: [device_registrations_ID], onDelete: Cascade, onUpdate: NoAction, map: "Logs_Alert_ibfk_1")

  @@index([device_registrations_ID], map: "device_registrations_ID")
}

model OTP {
  otp_id      Int      @id @default(autoincrement())
  user_id     Int
  otp_code    String   @db.VarChar(10)
  is_verified Boolean? @default(false)
  expired_at  DateTime @db.DateTime(0)
  Account     Account  @relation(fields: [user_id], references: [user_ID], onDelete: Cascade, map: "OTP_ibfk_1")

  @@index([user_id], map: "user_id")
}

model Permanent_Data {
  permanent_ID            Int                  @id @default(autoincrement())
  device_registrations_ID Int
  sensor_type             Int
  value                   Float                @db.Float
  unit                    String               @db.VarChar(20)
  measured_at             DateTime?            @default(now()) @db.DateTime(0)
  device_registrations    device_registrations @relation(fields: [device_registrations_ID], references: [device_registrations_ID], onDelete: Cascade, map: "Permanent_Data_ibfk_1")
  Sensor_Type             Sensor_Type          @relation(fields: [sensor_type], references: [sensor_type_ID], map: "Permanent_Data_ibfk_2")

  @@index([device_registrations_ID], map: "device_registrations_ID")
  @@index([sensor_type], map: "sensor_type")
}

model Sensor_Type {
  sensor_type_ID Int              @id @default(autoincrement())
  name           String           @db.VarChar(100)
  description    String?          @db.VarChar(255)
  Permanent_Data Permanent_Data[]
}

model User_Settings {
  user_settings_ID        Int                  @id @default(autoincrement())
  data_send_interval_days Float                @db.Float
  device_registrations_ID Int
  Water_level_min         Float?               @db.Float
  Water_level_mxm         Float                @default(0) @db.Float
  growth_analysis_period  Float                @db.Float
  device_registrations    device_registrations @relation(fields: [device_registrations_ID], references: [device_registrations_ID], onDelete: Cascade, map: "User_Settings_ibfk_1")

  @@index([device_registrations_ID], map: "device_registrations_ID")
}

model device_registrations {
  device_registrations_ID Int               @id @default(autoincrement())
  user_ID                 Int
  device_ID               Int
  status                  String?           @default("active") @db.VarChar(20)
  area_id                 Int
  registered_at           DateTime?         @default(now()) @db.DateTime(0)
  Growth_Analysis         Growth_Analysis[]
  Logs_Alert              Logs_Alert[]
  Permanent_Data          Permanent_Data[]
  User_Settings           User_Settings[]
  Account                 Account           @relation(fields: [user_ID], references: [user_ID], onDelete: Cascade, map: "device_registrations_ibfk_1")
  Area                    Area              @relation(fields: [area_id], references: [area_id], onDelete: Cascade, map: "device_registrations_ibfk_2")
  Device                  Device            @relation(fields: [device_ID], references: [device_ID], onDelete: Cascade, map: "device_registrations_ibfk_3")

  @@index([area_id], map: "area_id")
  @@index([device_ID], map: "device_registrations_ibfk_3")
  @@index([user_ID], map: "user_ID")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model system_settings {
  system_settings_ID      Int      @id @default(autoincrement())
  data_send_interval_days Float    @default(1) @db.Float
  growth_analysis_period  Float    @default(7) @db.Float
  water_level_min         Float    @default(5) @db.Float
  water_level_max         Float    @default(30) @db.Float
  updated_at              DateTime @default(now()) @db.DateTime(0)
}
